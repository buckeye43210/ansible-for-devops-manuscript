#Defining variables
MD_FILES     :=   frontmatter.txt \
                  foreword.txt \
                  preface.txt \
                  introduction.txt \
                  mainmatter.txt \
                  chapter1.txt \
                  chapter2.txt \
                  chapter3.txt \
                  chapter4.txt \
                  chapter5.txt \
                  chapter6.txt \
                  chapter7.txt \
                  chapter8.txt \
                  chapter9.txt \
                  chapter10.txt \
                  chapter11.txt \
                  chapter12.txt \
                  chapter13.txt \
                  chapter14.txt \
                  chapter15.txt \
                  afterword.txt \
                  backmatter.txt \
                  appendix-a.txt \
                  appendix-b.txt

COVER_IMAGE  :=   images/cover_art.svg
COVER_HEADER :=   cover_header.tex
COVER_BODY   :=   cover_body.tex
PDF_OUTPUT   :=   ansible-for-devops.pdf
EPUB_OUTPUT  :=   ansible-for-devops.epub
PANDOC       :=   pandoc
PANDOC_FLAGS := --from=markdown \
               -V geometry:a4paper,margin=.5in \
               -V documentclass=book \
               -V fontsize=11pt \
                --metadata title=Ansible for DevOps \
                --metadata-file=metadata.yaml
LATEX_FLAGS  := --pdf-engine=xelatex \
                --include-in-header=$(COVER_HEADER) \
                --include-before-body=$(COVER_BODY) \
                --template=eisvogel.latex
EPUB_FLAGS   := --css=epub.css

# Default target
all: pdf epub

# Generating PDF
pdf: $(PDF_OUTPUT)

$(PDF_OUTPUT): $(MD_FILES)
	$(PANDOC) $(PANDOC_FLAGS) $(LATEX_FLAGS) -o $@ $(MD_FILES)

# Generating EPUB
epub: $(EPUB_OUTPUT)

$(EPUB_OUTPUT): $(MD_FILES)
	$(PANDOC) $(PANDOC_FLAGS) $(EPUB_FLAGS) -o $@ $(MD_FILES)

# Cleaning up generated files
clean:
	rm -f $(PDF_OUTPUT) $(EPUB_OUTPUT)

.PHONY: all pdf epub clean
